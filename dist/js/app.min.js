(()=>{"use strict";const t=document.querySelector(".modal_product"),e=document.querySelector(".catalog__list"),o=document.querySelector(".modal-product__title"),c=document.querySelector(".modal-product__image"),n=document.querySelector(".modal-product__description"),r=document.querySelector(".ingredients__list"),a=document.querySelector(".ingredients__calories"),d=document.querySelector(".modal-product__price-count"),s=document.querySelector(".navigation__list"),i=document.querySelectorAll(".navigation__button"),u=document.querySelector(".catalog__title"),l=document.querySelector(".modal-product__btn"),_=document.querySelector(".modal_product .count__amount"),p=document.querySelector(".order__count"),m=document.querySelector(".order__list"),g=(document.querySelector(".order__total-amount"),"http://localhost:3024"),y="/api/product",$=async t=>{const e=await fetch(t);if(e.ok)return e.json()},v=t=>{const e=document.createElement("li");return e.classList.add("catalog__item"),e.innerHTML=`\n      <article class="product" data-id-product=${t.id}>\n        <img class="product__image" src="${g}/${t.image}" alt="${t.title}">\n        <p class="product__price">${t.price}<span class="currency">₽</span></p>\n        <h3 class="product__title">\n            <button class="product_detail">${t.title}</button>\n        </h3>\n        <p class="product__weight">${t.weight}</p>\n        <button class="product__add" type="button">Добавить</button>\n      </article>\n    `,e},S=async(t="burger")=>{e.textContent="";const o=(await $(`${g}${y}?category=${t}`)).map(v);e.append(...o)},b=()=>{const t=localStorage.getItem("cart");return t?JSON.parse(t):[]},L=async()=>{const t=b(),e=t.map((t=>t.id)),o=await $(`${g}${y}?list=${e}`),c=t.reduce(((t,e)=>t+e.count),0);p.textContent=c,m.textContent="";const n=o.map((e=>{const o=document.createElement("li");o.classList.add("order__item"),o.dataset.idProduct=e.id;const c=t.find((t=>t.id==e.id));return console.log("product: ",c.count),o.innerHTML=`\n            <img class="order__image" src="${g}/${e.image}" alt="${e.title}">\n            <div class="order__product">\n                <h3 class="order__product-title">${e.title}</h3>\n                <p class="order__product-weight">${e.weight}г</p>\n                <p class="order__product-price">${e.price}\n                    <span class="currency">₽</span>\n                </p>\n            </div>\n            <div class="order__product-count count">\n                <button class="count__minus">-</button>\n                <p class="count__amount">${c.count}</p>\n                <button class="count__plus">+</button>\n            </div>\n    `,o}));m.append(...n)},A=(t,e=1)=>{const o=b(),c=o.find((e=>e.id===t));c?c.count+=e:o.push({id:t,count:e}),(t=>{localStorage.setItem("cart",JSON.stringify(t)),L()})(o)};var q,h;q=function(t){1==t?document.querySelector("body").classList.add("webp"):document.querySelector("body").classList.add("no-webp")},(h=new Image).onload=h.onerror=function(){q(2===h.height)},h.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";const w=e=>{"Escape"==e.key&&(t.classList.remove("modal_open"),document.removeEventListener("keydown",w))};var C;e.addEventListener("click",(e=>{const s=e.target;(s.closest(".product_detail")||s.closest(".product__image"))&&((async e=>{const s=await $(`${g}${y}/${e}`);o.textContent=s.title,c.src=`${g}/${s.image}`,r.textContent="";const i=s.ingredients.map((t=>{const e=document.createElement("li");return e.classList.add("ingredients__item"),e.textContent=t,e}));r.append(...i),n.textContent=s.description,a.textContent=`${s.weight}г ккал ${s.calories}`,d.textContent=s.price,l.dataset.idProduct=s.id,t.classList.add("modal_open")})(s.closest(".product").dataset.idProduct),document.addEventListener("keydown",w))})),t.addEventListener("click",(e=>{const o=e.target;(o.closest(".modal__close")||o===t)&&t.classList.remove("modal_open")})),S(),C=S,s.addEventListener("click",(t=>{const e=t.target.closest(".navigation__button");e&&i.forEach((t=>{t===e?(t.classList.add("navigation__button_active"),u.textContent=t.textContent,C(t.dataset.category)):t.classList.remove("navigation__button_active")}))})),e.addEventListener("click",(({target:t})=>{t.closest(".product__add")&&A(t.closest(".product").dataset.idProduct)})),l.addEventListener("click",(()=>{A(l.dataset.idProduct,parseInt(_.textContent))})),L()})();